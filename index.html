<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OdinSight Tech Maturity Assessment</title>
    <style>
        :root {
            --primary: #4a9bd7;
            --secondary: #2ecc71;
            --danger: #e74c3c;
            --dark: #0a1622;
            --darker: #050d16;
            --light: #ecf0f1;
            --text-light: #ecf0f1;
            --text-dark: #2c3e50;
            --border-radius: 4px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--darker);
            color: var(--text-light);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            background-color: var(--dark);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(74, 155, 215, 0.2);
        }

        h1, h2, h3, h4 {
            color: var(--primary);
            margin-top: 0;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-light);
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(74, 155, 215, 0.3);
            border-radius: var(--border-radius);
            background-color: rgba(10, 22, 34, 0.8);
            color: var(--text-light);
            font-size: 16px;
            box-sizing: border-box;
        }

        /* Style for dropdown arrow */
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;utf8,<svg fill='white' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/><path d='M0 0h24v24H0z' fill='none'/></svg>");
            background-repeat: no-repeat;
            background-position: right 10px center;
            padding-right: 30px;
        }

        /* Remove default appearance */
        select::-ms-expand {
            display: none;
        }

        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        /* Style for dropdown options */
        select option {
            background-color: var(--dark);
            color: var(--text-light);
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(74, 155, 215, 0.5);
            background-color: rgba(255, 255, 255, 0.15);
        }

        button {
            background-color: rgba(74, 155, 215, 0.2);
            color: var(--text-light);
            border: 1px solid var(--primary);
            padding: 12px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        button:hover {
            background-color: rgba(74, 155, 215, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        button:disabled {
            background-color: rgba(74, 155, 215, 0.1);
            border-color: rgba(74, 155, 215, 0.2);
            color: rgba(236, 240, 241, 0.5);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--darker);
        }

        .login-card {
            width: 100%;
            max-width: 400px;
            padding: 30px;
            background-color: var(--dark);
            border-radius: var(--border-radius);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(74, 155, 215, 0.2);
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .login-form {
            margin-top: 20px;
        }

        .login-btn {
            width: 100%;
            margin-top: 20px;
            padding: 12px;
            font-size: 18px;
        }

        .login-error {
            color: var(--danger);
            margin-top: 15px;
            font-size: 14px;
            text-align: center;
            min-height: 20px;
        }

        .register-link {
            margin-top: 20px;
            text-align: center;
        }

        .register-link a {
            color: var(--primary);
            text-decoration: none;
        }

        .register-link a:hover {
            text-decoration: underline;
        }

        .register-form {
            display: none;
        }

        .back-to-login {
            margin-top: 20px;
            text-align: center;
        }

        .back-to-login a {
            color: var(--primary);
            text-decoration: none;
        }

        .back-to-login a:hover {
            text-decoration: underline;
        }

        /* App selection styles */
        .selected-apps {
            margin-top: 15px;
        }

        .selected-app-item {
            display: flex;
            align-items: center;
            background-color: rgba(10, 22, 34, 0.8);
            border: 1px solid rgba(74, 155, 215, 0.2);
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .selected-app-item span {
            flex-grow: 1;
        }

        .remove-app {
            background-color: var(--danger);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }

        .add-app-btn {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }

        .add-app-btn:disabled {
            background-color: rgba(46, 204, 113, 0.3);
            cursor: not-allowed;
        }

        #calculate-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
            width: 100%;
        }

        .results {
            display: none;
            margin-top: 30px;
        }

        .app-card {
            display: flex;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary);
            background-color: rgba(10, 22, 34, 0.9);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
            border: 1px solid rgba(74, 155, 215, 0.2);
        }

        .app-card-rank {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            background-color: var(--primary);
            color: var(--text-light);
            font-weight: bold;
            font-size: 24px;
        }

        .app-card-content {
            padding: 15px;
            flex-grow: 1;
            color: var(--text-light);
        }

        .app-card h3 {
            margin-bottom: 5px;
            color: var(--primary);
        }

        .app-card-stats {
            display: flex;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .stat {
            margin-right: 20px;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
            text-transform: uppercase;
        }

        .criteria-explanation {
            margin-bottom: 20px;
        }

        .criteria-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .criteria-item {
            background-color: rgba(10, 22, 34, 0.8);
            border: 1px solid rgba(74, 155, 215, 0.2);
            padding: 15px;
            border-radius: 4px;
        }

        .criteria-item h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .criteria-item p {
            margin: 0;
            font-size: 14px;
        }

        .recommendations {
            margin-top: 20px;
        }

        .recommendation-step {
            background-color: rgba(10, 22, 34, 0.8);
            border: 1px solid rgba(74, 155, 215, 0.2);
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }

        .recommendation-step h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .recommendation-step ul {
            margin: 0;
            padding-left: 20px;
        }

        .recommendation-step li {
            margin-bottom: 5px;
        }

        .alternatives {
            margin-top: 30px;
        }
        
        /* Maturity Score Styles */
        .maturity-score-container {
            display: flex;
            margin-bottom: 30px;
            background-color: rgba(10, 22, 34, 0.8);
            border: 1px solid rgba(74, 155, 215, 0.2);
            border-radius: 4px;
            padding: 20px;
        }
        
        .maturity-score {
            flex: 0 0 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-right: 1px solid rgba(74, 155, 215, 0.2);
            padding-right: 20px;
            margin-right: 20px;
        }
        
        .score-value {
            font-size: 48px;
            font-weight: bold;
            color: var(--primary);
        }
        
        .score-label {
            font-size: 14px;
            color: var(--text-light);
            text-align: center;
            margin-top: 10px;
        }
        
        .maturity-explanation {
            flex: 1;
        }
        
        /* App Analysis Styles */
        .app-analysis {
            margin-bottom: 30px;
        }
        
        .app-detail-card {
            background-color: rgba(10, 22, 34, 0.8);
            border: 1px solid rgba(74, 155, 215, 0.2);
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .app-detail-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(74, 155, 215, 0.2);
            padding-bottom: 10px;
        }
        
        .app-detail-name {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
        }
        
        .app-detail-score {
            font-size: 18px;
            font-weight: bold;
            color: var(--secondary);
        }
        
        .app-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .app-metric {
            background-color: rgba(10, 22, 34, 0.9);
            border: 1px solid rgba(74, 155, 215, 0.1);
            border-radius: 4px;
            padding: 10px;
        }
        
        .metric-name {
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 5px;
        }
        
        .metric-value {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
        }
        
        .app-strengths-weaknesses {
            display: flex;
            margin-top: 15px;
        }
        
        .app-strengths, .app-weaknesses {
            flex: 1;
            padding: 10px;
        }
        
        .app-strengths h4, .app-weaknesses h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .app-strengths {
            border-right: 1px solid rgba(74, 155, 215, 0.2);
        }
        
        /* Synergy Analysis Styles */
        .synergy-analysis {
            margin-bottom: 30px;
        }
        
        .synergy-matrix {
            background-color: rgba(10, 22, 34, 0.8);
            border: 1px solid rgba(74, 155, 215, 0.2);
            border-radius: 4px;
            padding: 20px;
            margin-top: 15px;
        }
        
        .synergy-pair {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(74, 155, 215, 0.1);
        }
        
        .synergy-apps {
            flex: 0 0 250px;
            font-weight: bold;
            color: var(--primary);
        }
        
        .synergy-score {
            flex: 0 0 80px;
            font-weight: bold;
            color: var(--secondary);
        }
        
        .synergy-description {
            flex: 1;
        }
        
        /* Implementation Plan Styles */
        .implementation-plan {
            margin-bottom: 30px;
        }
        
        .implementation-phase {
            background-color: rgba(10, 22, 34, 0.8);
            border: 1px solid rgba(74, 155, 215, 0.2);
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .phase-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(74, 155, 215, 0.2);
            padding-bottom: 10px;
        }
        
        .phase-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
        }
        
        .phase-timeline {
            font-size: 14px;
            color: var(--text-light);
        }
        
        .phase-tasks {
            margin-bottom: 15px;
        }
        
        .phase-resources {
            font-size: 14px;
            color: var(--text-light);
            font-style: italic;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .save-btn, .download-btn {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
        }
        
        .save-btn {
            background-color: var(--primary);
            color: white;
            border: none;
        }
        
        .download-btn {
            background-color: var(--secondary);
            color: white;
            border: none;
        }

        .alternative-app {
            background-color: rgba(10, 22, 34, 0.8);
            border: 1px solid rgba(74, 155, 215, 0.2);
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }

        .alternative-app h3 {
            margin-top: 0;
            margin-bottom: 5px;
            color: var(--secondary);
        }

        .alternative-app p {
            margin: 5px 0;
        }

        .alternative-app .pros-cons {
            display: flex;
            margin-top: 10px;
        }

        .alternative-app .pros, .alternative-app .cons {
            flex: 1;
        }

        .alternative-app h4 {
            margin-top: 0;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .alternative-app ul {
            margin: 0;
            padding-left: 20px;
        }

        .alternative-app li {
            margin-bottom: 3px;
            font-size: 14px;
        }

        .app-category {
            margin-bottom: 20px;
        }

        .app-category-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .app-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .app-item {
            background-color: rgba(10, 22, 34, 0.8);
            border: 1px solid rgba(74, 155, 215, 0.2);
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .app-item:hover {
            background-color: rgba(74, 155, 215, 0.2);
        }

        .app-item.selected {
            background-color: rgba(74, 155, 215, 0.4);
            border-color: var(--primary);
        }

        /* Admin panel styles */
        .admin-panel {
            display: none;
        }

        .user-list {
            margin-top: 20px;
        }

        .user-item {
            background-color: rgba(10, 22, 34, 0.8);
            border: 1px solid rgba(74, 155, 215, 0.2);
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .user-item h3 {
            margin-top: 0;
            margin-bottom: 5px;
        }

        .user-actions {
            margin-top: 10px;
        }

        .user-actions button {
            margin-right: 10px;
            padding: 6px 12px;
            font-size: 14px;
        }

        .delete-user {
            background-color: rgba(231, 76, 60, 0.2);
            border-color: var(--danger);
        }

        .delete-user:hover {
            background-color: rgba(231, 76, 60, 0.4);
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .card {
                padding: 15px;
            }

            .criteria-grid {
                grid-template-columns: 1fr;
            }

            .app-card {
                flex-direction: column;
            }

            .app-card-rank {
                width: 100%;
                padding: 5px 0;
            }

            .alternative-app .pros-cons {
                flex-direction: column;
            }

            .alternative-app .pros {
                margin-bottom: 15px;
            }
        }

        /* Profile section styles */
        .profile-section {
            margin-top: 30px;
        }

        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .profile-actions {
            display: flex;
            gap: 10px;
        }

        .profile-info {
            background-color: rgba(10, 22, 34, 0.8);
            border: 1px solid rgba(74, 155, 215, 0.2);
            padding: 20px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .profile-info-item {
            margin-bottom: 15px;
        }

        .profile-info-label {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .profile-info-value {
            color: var(--text-light);
        }

        .edit-profile-form {
            display: none;
        }

        /* Tab navigation */
        .tab-navigation {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(74, 155, 215, 0.2);
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: transparent;
            border: none;
            color: var(--text-light);
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            background-color: rgba(74, 155, 215, 0.1);
        }

        .tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <!-- Login Container (initially visible) -->
    <div id="login-container" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h1>OdinSight</h1>
                <h2>Tech Maturity Assessment</h2>
                <p>Please log in to access the assessment tool</p>
            </div>
            <div class="login-form">
                <div class="form-group">
                    <label for="username">Username:</label>
                    <input type="text" id="username" placeholder="Enter your username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password:</label>
                    <input type="password" id="password" placeholder="Enter your password" required>
                </div>
                <div id="login-error" class="login-error"></div>
                <button id="login-btn" class="login-btn">Log In</button>
                <div class="register-link">
                    <a href="#" id="show-register">Don't have an account? Register here</a>
                </div>
            </div>
            <div class="register-form" id="register-form">
                <div class="form-group">
                    <label for="reg-username">Username:</label>
                    <input type="text" id="reg-username" placeholder="Choose a username" required>
                </div>
                <div class="form-group">
                    <label for="reg-email">Email:</label>
                    <input type="email" id="reg-email" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="reg-password">Password:</label>
                    <input type="password" id="reg-password" placeholder="Choose a password" required>
                </div>
                <div class="form-group">
                    <label for="reg-confirm-password">Confirm Password:</label>
                    <input type="password" id="reg-confirm-password" placeholder="Confirm your password" required>
                </div>
                <div id="register-error" class="login-error"></div>
                <button id="register-btn" class="login-btn">Register</button>
                <div class="back-to-login">
                    <a href="#" id="show-login">Already have an account? Log in here</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content (initially hidden) -->
    <div id="main-content" style="display: none;">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="welcome-message">
                        <h1>Welcome to the Tech Maturity Assessment by OdinSight</h1>
                        <h2>Provided by Odin Tech Forge</h2>
                        <p>Our intuitive and well-designed assessment quickly evaluates your organization's technology maturity. You'll receive a comprehensive Tech Maturity Score along with tailored recommendations to guide your next steps, while effectively identifying both risks and opportunities.</p>
                    </div>
                    <div class="logout-container">
                        <button id="logout-btn" class="logout-btn">Logout</button>
                    </div>
                </div>
            </div>
        </header>

        <div class="container">
            <div class="tab-navigation">
                <button class="tab active" data-tab="assessment">Assessment</button>
                <button class="tab" data-tab="profile">Company Profile</button>
                <div id="admin-tab-container" style="display: none;">
                    <button class="tab" data-tab="admin">Admin Panel</button>
                </div>
            </div>

            <div id="assessment-tab" class="tab-content active">
                <!-- App Selection Section -->
                <div class="card">
                    <h2>Select Your Category and App</h2>
                    <div class="form-group">
                        <label for="category">Category:</label>
                        <select id="category">
                            <option value="">Select a category</option>
                            <option value="Email">Email & Collaboration</option>
                            <option value="Messaging">Messaging & Communication</option>
                            <option value="Data Storage">Data Storage & File Sharing</option>
                            <option value="Project Management">Project Management</option>
                            <option value="CRM">Customer Relationship Management</option>
                            <option value="Development">Development Tools</option>
                            <option value="Analytics">Analytics & Business Intelligence</option>
                            <option value="Security">Security & Compliance</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="app">App:</label>
                        <select id="app" disabled>
                            <option value="">First select a category</option>
                        </select>
                        <button id="add-app-btn" class="add-app-btn" disabled>Add App</button>
                    </div>
                    <div class="selected-apps" id="selected-apps">
                        <!-- Selected apps will be displayed here -->
                        <p id="no-apps-message">No apps selected yet. You can select up to 8 apps.</p>
                    </div>
                </div>

                <div class="card">
                    <h2>Company Profile</h2>
                    <div class="form-group">
                        <label for="company-name">Company Name:</label>
                        <input type="text" id="company-name" placeholder="Enter your company name" required>
                    </div>
                    <div class="form-group">
                        <label for="team-size">Team Size:</label>
                        <select id="team-size" required>
                            <option value="1-10">1-10</option>
                            <option value="11-50">11-50</option>
                            <option value="51-200">51-200</option>
                            <option value="200+">200+</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="infrastructure">Where is your infrastructure hosted?</label>
                        <select id="infrastructure" required>
                            <option value="On-premise">On-premise</option>
                            <option value="Hybrid">Hybrid</option>
                            <option value="Cloud-first (AWS, Azure, GCP)">Cloud-first (AWS, Azure, GCP)</option>
                            <option value="Fully automated cloud-native">Fully automated cloud-native</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="disaster-recovery">Disaster Recovery / Backup Strategy:</label>
                        <select id="disaster-recovery" required>
                            <option value="No backups">No backups</option>
                            <option value="Manual occasionally">Manual occasionally</option>
                            <option value="Automated daily">Automated daily</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="security">Security Practices:</label>
                        <select id="security" required>
                            <option value="None">None</option>
                            <option value="Ad-hoc">Ad-hoc</option>
                            <option value="Regular vulnerability scans">Regular vulnerability scans</option>
                            <option value="Formal framework (ISO 27001, SOC2)">Formal framework (ISO 27001, SOC2)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="gdpr">GDPR / Data Privacy Compliance:</label>
                        <select id="gdpr" required>
                            <option value="None">None</option>
                            <option value="In progress">In progress</option>
                            <option value="Fully compliant with audits">Fully compliant with audits</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="deployment">Deployment Process:</label>
                        <select id="deployment" required>
                            <option value="Manual">Manual</option>
                            <option value="Basic CI/CD">Basic CI/CD</option>
                            <option value="Automated CI/CD + testing">Automated CI/CD + testing</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="version-control">Version Control:</label>
                        <select id="version-control" required>
                            <option value="No">No</option>
                            <option value="Yes, but inconsistently">Yes, but inconsistently</option>
                            <option value="Yes, fully standardized">Yes, fully standardized</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="cto">Technical Leadership:</label>
                        <select id="cto" required>
                            <option value="No dedicated tech leader">No dedicated tech leader</option>
                            <option value="Part-time/fractional support">Part-time/fractional support</option>
                            <option value="Dedicated CTO">Dedicated CTO</option>
                            <option value="CTO + leadership team">CTO + leadership team</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="roadmap">Technology Roadmap Review Frequency:</label>
                        <select id="roadmap" required>
                            <option value="Never">Never</option>
                            <option value="Once a year">Once a year</option>
                            <option value="Quarterly">Quarterly</option>
                            <option value="Continuous">Continuous</option>
                        </select>
                    </div>
                    
                    <h3>AI Readiness</h3>
                    
                    <div class="form-group">
                        <label for="ai-usage">Current AI Usage:</label>
                        <select id="ai-usage" required>
                            <option value="Not at all">Not at all</option>
                            <option value="Experimenting in some departments">Experimenting in some departments</option>
                            <option value="Integrated into workflows (e.g., analytics, automation)">Integrated into workflows (e.g., analytics, automation)</option>
                            <option value="Core part of products/services">Core part of products/services</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="ai-strategy">AI Strategy:</label>
                        <select id="ai-strategy" required>
                            <option value="No strategy/policy">No strategy/policy</option>
                            <option value="Some guidelines, not standardized">Some guidelines, not standardized</option>
                            <option value="Formal AI strategy in progress">Formal AI strategy in progress</option>
                            <option value="Comprehensive AI strategy with governance">Comprehensive AI strategy with governance</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="ai-ethics">AI Ethics & Governance:</label>
                        <select id="ai-ethics" required>
                            <option value="Not considered">Not considered</option>
                            <option value="Ad-hoc awareness">Ad-hoc awareness</option>
                            <option value="Formal reviews & partial safeguards">Formal reviews & partial safeguards</option>
                            <option value="Fully established AI governance framework">Fully established AI governance framework</option>
                        </select>
                    </div>
                    
                    <button id="calculate-btn">Calculate Optimization Steps</button>
                </div>
                
                <div class="results" id="results">
                    <div class="card">
                        <h2>Tech Maturity Assessment Results</h2>
                        <div class="maturity-score-container">
                            <div class="maturity-score" id="maturity-score">
                                <!-- Maturity score will be displayed here -->
                            </div>
                            <div class="maturity-explanation">
                                <p>Your Tech Maturity Score represents your organization's overall technological readiness across key dimensions including infrastructure, security, development practices, leadership, and AI readiness.</p>
                                <p>This score serves as a benchmark for your current state and helps identify priority areas for improvement.</p>
                            </div>
                        </div>

                        <h2>App Ranking Criteria</h2>
                        <div class="criteria-explanation">
                            <p>Our app ranking system evaluates software across seven key dimensions that are critical for business success:</p>
                            <div class="criteria-grid">
                                <div class="criteria-item">
                                    <h3>Functionality / Features (1–5)</h3>
                                    <p>How well the app meets core business needs with essential features and capabilities.</p>
                                </div>
                                <div class="criteria-item">
                                    <h3>User Experience (1–5)</h3>
                                    <p>Ease of use, interface design, and overall user satisfaction.</p>
                                </div>
                                <div class="criteria-item">
                                    <h3>Integration Capabilities (1–5)</h3>
                                    <p>How well the app connects with other tools in your tech stack.</p>
                                </div>
                                <div class="criteria-item">
                                    <h3>Scalability (1–5)</h3>
                                    <p>Ability to grow with your business without performance degradation.</p>
                                </div>
                                <div class="criteria-item">
                                    <h3>Security & Compliance (1–5)</h3>
                                    <p>Data protection, privacy features, and regulatory compliance.</p>
                                </div>
                                <div class="criteria-item">
                                    <h3>Support & Reliability (1–5)</h3>
                                    <p>Quality of customer support, uptime, and overall reliability.</p>
                                </div>
                                <div class="criteria-item">
                                    <h3>Value for Money (1–5)</h3>
                                    <p>Return on investment considering cost vs. benefits.</p>
                                </div>
                            </div>
                        </div>
                        
                        <h2>Your App Rankings</h2>
                        <div id="app-rankings"></div>
                        
                        <div id="current-app-details"></div>
                        
                        <h2>Detailed Application Analysis</h2>
                        <div class="app-analysis" id="app-analysis">
                            <!-- Detailed app analysis will be displayed here -->
                        </div>

                        <h2>Synergy Analysis</h2>
                        <div class="synergy-analysis" id="synergy-analysis">
                            <p>This analysis examines how your selected applications work together to create additional value through integration and workflow optimization.</p>
                            <!-- Synergy analysis will be displayed here -->
                        </div>
                        
                        <h2>Recommended Optimization Steps</h2>
                        <div class="recommendations" id="recommendations"></div>

                        <h2>Detailed Implementation Plan</h2>
                        <div class="implementation-plan" id="implementation-plan">
                            <!-- Implementation plan will be displayed here -->
                        </div>

                        <div class="action-buttons">
                            <button id="save-assessment-btn" class="save-btn">Save Assessment Results</button>
                            <button id="download-pdf-btn" class="download-btn">Download PDF Report</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="profile-tab" class="tab-content">
                <div class="card">
                    <div class="profile-header">
                        <h2>Company Profile</h2>
                        <div class="profile-actions">
                            <button id="edit-profile-btn">Edit Profile</button>
                            <button id="save-profile-btn">Save Profile</button>
                        </div>
                    </div>
                    
                    <div id="profile-info" class="profile-info">
                        <!-- Profile information will be displayed here -->
                        <p>Loading profile information...</p>
                    </div>
                    
                    <div id="edit-profile-form" class="edit-profile-form">
                        <div class="form-group">
                            <label for="edit-company-name">Company Name:</label>
                            <input type="text" id="edit-company-name" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-team-size">Team Size:</label>
                            <select id="edit-team-size" required>
                                <option value="1-10">1-10</option>
                                <option value="11-50">11-50</option>
                                <option value="51-200">51-200</option>
                                <option value="200+">200+</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-infrastructure">Infrastructure:</label>
                            <select id="edit-infrastructure" required>
                                <option value="On-premise">On-premise</option>
                                <option value="Hybrid">Hybrid</option>
                                <option value="Cloud-first (AWS, Azure, GCP)">Cloud-first (AWS, Azure, GCP)</option>
                                <option value="Fully automated cloud-native">Fully automated cloud-native</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-disaster-recovery">Disaster Recovery:</label>
                            <select id="edit-disaster-recovery" required>
                                <option value="No backups">No backups</option>
                                <option value="Manual occasionally">Manual occasionally</option>
                                <option value="Automated daily">Automated daily</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-security">Security:</label>
                            <select id="edit-security" required>
                                <option value="None">None</option>
                                <option value="Ad-hoc">Ad-hoc</option>
                                <option value="Regular vulnerability scans">Regular vulnerability scans</option>
                                <option value="Formal framework (ISO 27001, SOC2)">Formal framework (ISO 27001, SOC2)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-gdpr">GDPR Compliance:</label>
                            <select id="edit-gdpr" required>
                                <option value="None">None</option>
                                <option value="In progress">In progress</option>
                                <option value="Fully compliant with audits">Fully compliant with audits</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-deployment">Deployment Process:</label>
                            <select id="edit-deployment" required>
                                <option value="Manual">Manual</option>
                                <option value="Basic CI/CD">Basic CI/CD</option>
                                <option value="Automated CI/CD + testing">Automated CI/CD + testing</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-version-control">Version Control:</label>
                            <select id="edit-version-control" required>
                                <option value="No">No</option>
                                <option value="Yes, but inconsistently">Yes, but inconsistently</option>
                                <option value="Yes, fully standardized">Yes, fully standardized</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-cto">Technical Leadership:</label>
                            <select id="edit-cto" required>
                                <option value="No dedicated tech leader">No dedicated tech leader</option>
                                <option value="Part-time/fractional support">Part-time/fractional support</option>
                                <option value="Dedicated CTO">Dedicated CTO</option>
                                <option value="CTO + leadership team">CTO + leadership team</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-roadmap">Roadmap Review:</label>
                            <select id="edit-roadmap" required>
                                <option value="Never">Never</option>
                                <option value="Once a year">Once a year</option>
                                <option value="Quarterly">Quarterly</option>
                                <option value="Continuous">Continuous</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-ai-usage">AI Usage:</label>
                            <select id="edit-ai-usage" required>
                                <option value="Not at all">Not at all</option>
                                <option value="Experimenting in some departments">Experimenting in some departments</option>
                                <option value="Integrated into workflows (e.g., analytics, automation)">Integrated into workflows (e.g., analytics, automation)</option>
                                <option value="Core part of products/services">Core part of products/services</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-ai-strategy">AI Strategy:</label>
                            <select id="edit-ai-strategy" required>
                                <option value="No strategy/policy">No strategy/policy</option>
                                <option value="Some guidelines, not standardized">Some guidelines, not standardized</option>
                                <option value="Formal AI strategy in progress">Formal AI strategy in progress</option>
                                <option value="Comprehensive AI strategy with governance">Comprehensive AI strategy with governance</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-ai-ethics">AI Ethics:</label>
                            <select id="edit-ai-ethics" required>
                                <option value="Not considered">Not considered</option>
                                <option value="Ad-hoc awareness">Ad-hoc awareness</option>
                                <option value="Formal reviews & partial safeguards">Formal reviews & partial safeguards</option>
                                <option value="Fully established AI governance framework">Fully established AI governance framework</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div id="admin-tab" class="tab-content">
                <div class="card">
                    <h2>Admin Panel</h2>
                    <div class="user-list" id="user-list">
                        <!-- User list will be displayed here -->
                        <p>Loading users...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Define API_URL once - this is the only place it should be defined
        const API_URL = 'https://odin-sight-backend.vercel.app/api';

        // DOM Elements
        const loginContainer = document.getElementById('login-container');
        const mainContent = document.getElementById('main-content');
        const loginForm = document.querySelector('.login-form');
        const registerForm = document.getElementById('register-form');
        const showRegisterLink = document.getElementById('show-register');
        const showLoginLink = document.getElementById('show-login');
        const loginBtn = document.getElementById('login-btn');
        const registerBtn = document.getElementById('register-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const loginError = document.getElementById('login-error');
        const registerError = document.getElementById('register-error');
        const adminTabContainer = document.getElementById('admin-tab-container');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const editProfileBtn = document.getElementById('edit-profile-btn');
        const saveProfileBtn = document.getElementById('save-profile-btn');
        const profileInfo = document.getElementById('profile-info');
        const editProfileForm = document.getElementById('edit-profile-form');
        const userList = document.getElementById('user-list');

        // App selection elements
        const categorySelect = document.getElementById('category');
        const appSelect = document.getElementById('app');
        const addAppBtn = document.getElementById('add-app-btn');
        const selectedAppsDiv = document.getElementById('selected-apps');
        const noAppsMessage = document.getElementById('no-apps-message');
        const calculateBtn = document.getElementById('calculate-btn');
        const resultsDiv = document.getElementById('results');
        const currentAppDetails = document.getElementById('current-app-details');
        const recommendationsDiv = document.getElementById('recommendations');
        const appRankingsDiv = document.getElementById('app-rankings');

        // Array to store selected apps
        let selectedApps = [];
        const MAX_APPS = 8;

        // App data
        const appData = {
            "Email": [
                {
                    name: "Gmail",
                    category: "Email",
                    overallScore: 4.5,
                    functionality: 4,
                    userExperience: 5,
                    integration: 4,
                    scalability: 5,
                    security: 4,
                    support: 4,
                    value: 5,
                    synergyWith: {
                        "Google Drive": 0.3,
                        "Google Meet": 0.3,
                        "Google Calendar": 0.3
                    }
                },
                {
                    name: "Microsoft Outlook",
                    category: "Email",
                    overallScore: 4.2,
                    functionality: 5,
                    userExperience: 4,
                    integration: 5,
                    scalability: 4,
                    security: 4,
                    support: 4,
                    value: 4,
                    synergyWith: {
                        "Microsoft Teams": 0.3,
                        "OneDrive": 0.3,
                        "Microsoft 365": 0.3
                    }
                },
                {
                    name: "ProtonMail",
                    category: "Email",
                    overallScore: 3.8,
                    functionality: 3,
                    userExperience: 4,
                    integration: 3,
                    scalability: 4,
                    security: 5,
                    support: 3,
                    value: 4
                },
                {
                    name: "Zoho Mail",
                    category: "Email",
                    overallScore: 4.0,
                    functionality: 4,
                    userExperience: 4,
                    integration: 4,
                    scalability: 4,
                    security: 4,
                    support: 3,
                    value: 5
                },
                {
                    name: "Google Workspace",
                    category: "Email",
                    overallScore: 4.6,
                    functionality: 5,
                    userExperience: 5,
                    integration: 5,
                    scalability: 5,
                    security: 4,
                    support: 4,
                    value: 4,
                    synergyWith: {
                        "Google Drive": 0.4,
                        "Google Meet": 0.4,
                        "Google Calendar": 0.4
                    }
                }
            ],
            "Messaging": [
                {
                    name: "Slack",
                    category: "Messaging",
                    overallScore: 4.7,
                    functionality: 5,
                    userExperience: 5,
                    integration: 5,
                    scalability: 4,
                    security: 4,
                    support: 5,
                    value: 4,
                    synergyWith: {
                        "Google Drive": 0.2,
                        "Trello": 0.2,
                        "GitHub": 0.2
                    }
                },
                {
                    name: "Microsoft Teams",
                    category: "Messaging",
                    overallScore: 4.3,
                    functionality: 5,
                    userExperience: 3,
                    integration: 5,
                    scalability: 5,
                    security: 4,
                    support: 4,
                    value: 4,
                    synergyWith: {
                        "Microsoft Outlook": 0.3,
                        "OneDrive": 0.3,
                        "Microsoft 365": 0.3
                    }
                },
                {
                    name: "Discord",
                    category: "Messaging",
                    overallScore: 3.9,
                    functionality: 4,
                    userExperience: 4,
                    integration: 3,
                    scalability: 4,
                    security: 3,
                    support: 3,
                    value: 5
                },
                {
                    name: "Zoom",
                    category: "Messaging",
                    overallScore: 4.6,
                    functionality: 5,
                    userExperience: 5,
                    integration: 4,
                    scalability: 5,
                    security: 4,
                    support: 4,
                    value: 5
                },
                {
                    name: "Google Meet",
                    category: "Messaging",
                    overallScore: 4.3,
                    functionality: 4,
                    userExperience: 5,
                    integration: 4,
                    scalability: 5,
                    security: 4,
                    support: 4,
                    value: 5,
                    synergyWith: {
                        "Gmail": 0.3,
                        "Google Drive": 0.3,
                        "Google Calendar": 0.3
                    }
                },
                {
                    name: "Intercom",
                    category: "Messaging",
                    overallScore: 4.4,
                    functionality: 5,
                    userExperience: 4,
                    integration: 5,
                    scalability: 4,
                    security: 4,
                    support: 4,
                    value: 4,
                    synergyWith: {
                        "Salesforce": 0.3,
                        "HubSpot": 0.3
                    }
                }
            ],
            "Data Storage": [
                {
                    name: "Google Drive",
                    category: "Data Storage",
                    overallScore: 4.5,
                    functionality: 4,
                    userExperience: 5,
                    integration: 5,
                    scalability: 5,
                    security: 4,
                    support: 4,
                    value: 5,
                    synergyWith: {
                        "Gmail": 0.3,
                        "Google Meet": 0.3,
                        "Google Calendar": 0.3
                    }
                },
                {
                    name: "Dropbox",
                    category: "Data Storage",
                    overallScore: 4.3,
                    functionality: 4,
                    userExperience: 5,
                    integration: 4,
                    scalability: 4,
                    security: 4,
                    support: 4,
                    value: 4
                },
                {
                    name: "OneDrive",
                    category: "Data Storage",
                    overallScore: 4.2,
                    functionality: 4,
                    userExperience: 4,
                    integration: 5,
                    scalability: 4,
                    security: 4,
                    support: 4,
                    value: 4,
                    synergyWith: {
                        "Microsoft Outlook": 0.3,
                        "Microsoft Teams": 0.3,
                        "Microsoft 365": 0.3
                    }
                },
                {
                    name: "Box",
                    category: "Data Storage",
                    overallScore: 4.1,
                    functionality: 4,
                    userExperience: 4,
                    integration: 4,
                    scalability: 4,
                    security: 5,
                    support: 4,
                    value: 3
                },
                {
                    name: "AWS S3",
                    category: "Data Storage",
                    overallScore: 4.4,
                    functionality: 5,
                    userExperience: 3,
                    integration: 5,
                    scalability: 5,
                    security: 5,
                    support: 4,
                    value: 4
                }
            ],
            "Project Management": [
                {
                    name: "Asana",
                    category: "Project Management",
                    overallScore: 4.5,
                    functionality: 4,
                    userExperience: 5,
                    integration: 4,
                    scalability: 4,
                    security: 4,
                    support: 4,
                    value: 4
                },
                {
                    name: "Trello",
                    category: "Project Management",
                    overallScore: 4.2,
                    functionality: 3,
                    userExperience: 5,
                    integration: 4,
                    scalability: 4,
                    security: 4,
                    support: 4,
                    value: 5,
                    synergyWith: {
                        "Slack": 0.2,
                        "Google Drive": 0.2
                    }
                },
                {
                    name: "Jira",
                    category: "Project Management",
                    overallScore: 4.4,
                    functionality: 5,
                    userExperience: 3,
                    integration: 5,
                    scalability: 5,
                    security: 4,
                    support: 4,
                    value: 4,
                    synergyWith: {
                        "Confluence": 0.4,
                        "Bitbucket": 0.3
                    }
                },
                {
                    name: "Monday.com",
                    category: "Project Management",
                    overallScore: 4.3,
                    functionality: 4,
                    userExperience: 5,
                    integration: 4,
                    scalability: 4,
                    security: 4,
                    support: 4,
                    value: 3
                },
                {
                    name: "ClickUp",
                    category: "Project Management",
                    overallScore: 4.4,
                    functionality: 5,
                    userExperience: 4,
                    integration: 4,
                    scalability: 4,
                    security: 4,
                    support: 4,
                    value: 5
                }
            ],
            "CRM": [
                {
                    name: "Salesforce",
                    category: "CRM",
                    overallScore: 4.7,
                    functionality: 5,
                    userExperience: 4,
                    integration: 5,
                    scalability: 5,
                    security: 5,
                    support: 4,
                    value: 3,
                    synergyWith: {
                        "Slack": 0.3,
                        "Tableau": 0.3
                    }
                },
                {
                    name: "HubSpot",
                    category: "CRM",
                    overallScore: 4.5,
                    functionality: 4,
                    userExperience: 5,
                    integration: 4,
                    scalability: 4,
                    security: 4,
                    support: 5,
                    value: 4,
                    synergyWith: {
                        "Gmail": 0.2,
                        "Outlook": 0.2
                    }
                },
                {
                    name: "Zoho CRM",
                    category: "CRM",
                    overallScore: 4.3,
                    functionality: 4,
                    userExperience: 4,
                    integration: 4,
                    scalability: 4,
                    security: 4,
                    support: 4,
                    value: 5
                },
                {
                    name: "Pipedrive",
                    category: "CRM",
                    overallScore: 4.2,
                    functionality: 4,
                    userExperience: 5,
                    integration: 4,
                    scalability: 4,
                    security: 4,
                    support: 4,
                    value: 4
                },
                {
                    name: "Microsoft Dynamics",
                    category: "CRM",
                    overallScore: 4.4,
                    functionality: 5,
                    userExperience: 3,
                    integration: 5,
                    scalability: 5,
                    security: 5,
                    support: 4,
                    value: 3,
                    synergyWith: {
                        "Microsoft Teams": 0.3,
                        "Office 365": 0.3
                    }
                }
            ],
            "Development": [
                {
                    name: "GitHub",
                    category: "Development",
                    overallScore: 4.8,
                    functionality: 5,
                    userExperience: 4,
                    integration: 5,
                    scalability: 5,
                    security: 5,
                    support: 4,
                    value: 5,
                    synergyWith: {
                        "VS Code": 0.3,
                        "Jira": 0.2
                    }
                },
                {
                    name: "GitLab",
                    category: "Development",
                    overallScore: 4.6,
                    functionality: 5,
                    userExperience: 4,
                    integration: 5,
                    scalability: 5,
                    security: 5,
                    support: 4,
                    value: 4
                },
                {
                    name: "VS Code",
                    category: "Development",
                    overallScore: 4.9,
                    functionality: 5,
                    userExperience: 5,
                    integration: 5,
                    scalability: 4,
                    security: 4,
                    support: 5,
                    value: 5
                },
                {
                    name: "IntelliJ IDEA",
                    category: "Development",
                    overallScore: 4.7,
                    functionality: 5,
                    userExperience: 4,
                    integration: 5,
                    scalability: 5,
                    security: 4,
                    support: 4,
                    value: 4
                },
                {
                    name: "Docker",
                    category: "Development",
                    overallScore: 4.6,
                    functionality: 5,
                    userExperience: 4,
                    integration: 5,
                    scalability: 5,
                    security: 4,
                    support: 4,
                    value: 5
                }
            ],
            "Analytics": [
                {
                    name: "Google Analytics",
                    category: "Analytics",
                    overallScore: 4.5,
                    functionality: 5,
                    userExperience: 4,
                    integration: 5,
                    scalability: 5,
                    security: 4,
                    support: 3,
                    value: 5
                },
                {
                    name: "Tableau",
                    category: "Analytics",
                    overallScore: 4.7,
                    functionality: 5,
                    userExperience: 4,
                    integration: 5,
                    scalability: 5,
                    security: 4,
                    support: 4,
                    value: 3,
                    synergyWith: {
                        "Salesforce": 0.3
                    }
                },
                {
                    name: "Power BI",
                    category: "Analytics",
                    overallScore: 4.6,
                    functionality: 5,
                    userExperience: 4,
                    integration: 5,
                    scalability: 5,
                    security: 5,
                    support: 4,
                    value: 4,
                    synergyWith: {
                        "Microsoft 365": 0.3,
                        "Dynamics": 0.3
                    }
                },
                {
                    name: "Looker",
                    category: "Analytics",
                    overallScore: 4.4,
                    functionality: 5,
                    userExperience: 4,
                    integration: 4,
                    scalability: 5,
                    security: 4,
                    support: 4,
                    value: 3
                },
                {
                    name: "Mixpanel",
                    category: "Analytics",
                    overallScore: 4.2,
                    functionality: 4,
                    userExperience: 4,
                    integration: 4,
                    scalability: 4,
                    security: 4,
                    support: 4,
                    value: 4
                }
            ],
            "Security": [
                {
                    name: "Okta",
                    category: "Security",
                    overallScore: 4.7,
                    functionality: 5,
                    userExperience: 4,
                    integration: 5,
                    scalability: 5,
                    security: 5,
                    support: 4,
                    value: 4
                },
                {
                    name: "LastPass",
                    category: "Security",
                    overallScore: 4.3,
                    functionality: 4,
                    userExperience: 4,
                    integration: 4,
                    scalability: 4,
                    security: 5,
                    support: 4,
                    value: 5
                },
                {
                    name: "1Password",
                    category: "Security",
                    overallScore: 4.5,
                    functionality: 4,
                    userExperience: 5,
                    integration: 4,
                    scalability: 4,
                    security: 5,
                    support: 4,
                    value: 5
                },
                {
                    name: "CrowdStrike",
                    category: "Security",
                    overallScore: 4.8,
                    functionality: 5,
                    userExperience: 4,
                    integration: 5,
                    scalability: 5,
                    security: 5,
                    support: 5,
                    value: 4
                },
                {
                    name: "Cloudflare",
                    category: "Security",
                    overallScore: 4.6,
                    functionality: 5,
                    userExperience: 4,
                    integration: 4,
                    scalability: 5,
                    security: 5,
                    support: 4,
                    value: 5
                }
            ]
        };

        // Scoring system for company profile
        const scoringSystem = {
            "team-size": {
                "1-10": 1,
                "11-50": 2,
                "51-200": 3,
                "200+": 4
            },
            "infrastructure": {
                "On-premise": 1,
                "Hybrid": 2,
                "Cloud-first (AWS, Azure, GCP)": 3,
                "Fully automated cloud-native": 5
            },
            "disaster-recovery": {
                "No backups": 1,
                "Manual occasionally": 2,
                "Automated daily": 4
            },
            "security": {
                "None": 1,
                "Ad-hoc": 2,
                "Regular vulnerability scans": 3,
                "Formal framework (ISO 27001, SOC2)": 5
            },
            "gdpr": {
                "None": 1,
                "In progress": 3,
                "Fully compliant with audits": 5
            },
            "deployment": {
                "Manual": 1,
                "Basic CI/CD": 3,
                "Automated CI/CD + testing": 5
            },
            "version-control": {
                "No": 1,
                "Yes, but inconsistently": 3,
                "Yes, fully standardized": 5
            },
            "cto": {
                "No dedicated tech leader": 1,
                "Part-time/fractional support": 2,
                "Dedicated CTO": 4,
                "CTO + leadership team": 5
            },
            "roadmap": {
                "Never": 1,
                "Once a year": 2,
                "Quarterly": 4,
                "Continuous": 5
            },
            "ai-usage": {
                "Not at all": 1,
                "Experimenting in some departments": 2,
                "Integrated into workflows (e.g., analytics, automation)": 4,
                "Core part of products/services": 5
            },
            "ai-strategy": {
                "No strategy/policy": 1,
                "Some guidelines, not standardized": 2,
                "Formal AI strategy in progress": 4,
                "Comprehensive AI strategy with governance": 5
            },
            "ai-ethics": {
                "Not considered": 1,
                "Ad-hoc awareness": 2,
                "Formal reviews & partial safeguards": 4,
                "Fully established AI governance framework": 5
            }
        };

        // Synergy calculation function
        function calculateCombinedScore(app, selectedApps) {
            let synergyBonus = 0;
            if (app.synergyWith) {
                selectedApps.forEach(selApp => {
                    if (app.synergyWith[selApp.name]) {
                        synergyBonus += app.synergyWith[selApp.name];
                    }
                });
            }
            return Math.min(5, app.overallScore + synergyBonus); // cap at 5
        }

        // Populate app dropdown based on category selection
        categorySelect.addEventListener('change', function() {
            const category = this.value;
            appSelect.innerHTML = '<option value="">Select an app</option>';
            
            if (!category) {
                appSelect.disabled = true;
                addAppBtn.disabled = true;
                return;
            }
            
            let apps = [];
            
            // Find apps for the selected category
            if (appData[category]) {
                apps = appData[category];
            } else {
                // Fallback for any category not in our data
                apps = [
                    { name: `${category} App 1`, category: category, overallScore: 4.2 },
                    { name: `${category} App 2`, category: category, overallScore: 3.8 },
                    { name: `${category} App 3`, category: category, overallScore: 4.5 }
                ];
            }
            
            // Add apps to dropdown
            apps.forEach(app => {
                const option = document.createElement('option');
                option.value = app.name;
                option.textContent = app.name;
                appSelect.appendChild(option);
            });
            
            appSelect.disabled = false;
            
            // Enable add button if an app is selected
            appSelect.addEventListener('change', function() {
                addAppBtn.disabled = !this.value;
            });
        });
        
        // Add app button click handler
        addAppBtn.addEventListener('click', function() {
            const category = categorySelect.value;
            const appName = appSelect.value;
            
            if (!category || !appName) {
                return;
            }
            
            // Check if app is already selected
            if (selectedApps.some(app => app.name === appName)) {
                alert('This app is already selected.');
                return;
            }
            
            // Check if maximum number of apps is reached
            if (selectedApps.length >= MAX_APPS) {
                alert(`You can select a maximum of ${MAX_APPS} apps.`);
                return;
            }
            
            // Find the selected app
            let selectedApp;
            if (appData[category]) {
                selectedApp = appData[category].find(app => app.name === appName);
            }
            
            // If app not found, create a placeholder
            if (!selectedApp) {
                selectedApp = {
                    name: appName,
                    category: category,
                    overallScore: 4.0,
                    functionality: 4,
                    userExperience: 4,
                    integration: 4,
                    scalability: 4,
                    security: 4,
                    support: 4,
                    value: 4
                };
            }
            
            // Add app to selected apps
            selectedApps.push(selectedApp);
            
            // Update UI
            updateSelectedAppsUI();
            
            // Reset app dropdown
            appSelect.value = '';
            addAppBtn.disabled = true;
        });
        
        // Update selected apps UI
        function updateSelectedAppsUI() {
            // Clear selected apps div
            selectedAppsDiv.innerHTML = '';
            
            // Show message if no apps selected
            if (selectedApps.length === 0) {
                selectedAppsDiv.innerHTML = '<p id="no-apps-message">No apps selected yet. You can select up to 8 apps.</p>';
                return;
            }
            
            // Add selected apps to UI
            selectedApps.forEach((app, index) => {
                const appItem = document.createElement('div');
                appItem.className = 'selected-app-item';
                appItem.innerHTML = `
                    <span>${app.name} (${app.category})</span>
                    <button class="remove-app" data-index="${index}">Remove</button>
                `;
                selectedAppsDiv.appendChild(appItem);
            });
            
            // Add event listeners to remove buttons
            document.querySelectorAll('.remove-app').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    selectedApps.splice(index, 1);
                    updateSelectedAppsUI();
                });
            });
        }
        
        // Calculate button click handler
        calculateBtn.addEventListener('click', async function() {
            // Check if at least one app is selected
            if (selectedApps.length === 0) {
                alert('Please select at least one app to calculate optimization steps.');
                return;
            }
            
            // Get company profile data
            const companyProfile = {
                companyName: document.getElementById('company-name').value,
                teamSize: document.getElementById('team-size').value,
                infrastructure: document.getElementById('infrastructure').value,
                disasterRecovery: document.getElementById('disaster-recovery').value,
                security: document.getElementById('security').value,
                gdpr: document.getElementById('gdpr').value,
                deployment: document.getElementById('deployment').value,
                versionControl: document.getElementById('version-control').value,
                cto: document.getElementById('cto').value,
                roadmap: document.getElementById('roadmap').value,
                aiUsage: document.getElementById('ai-usage').value,
                aiStrategy: document.getElementById('ai-strategy').value,
                aiEthics: document.getElementById('ai-ethics').value
            };
            
            // Auto-save profile data to database before calculating
            try {
                const token = localStorage.getItem('token');
                if (token) {
                    const profileData = {
                        ...companyProfile,
                        selectedApps: selectedApps.map(app => ({ name: app.name, category: app.category }))
                    };
                    
                    console.log('Auto-saving profile data:', profileData);
                    
                    const response = await fetch(`${API_URL}/profile`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify(profileData)
                    });
                    
                    if (response.ok) {
                        console.log('Profile data auto-saved successfully');
                    }
                }
            } catch (error) {
                console.error('Error auto-saving profile:', error);
                // Continue with calculation even if save fails
            }
            
            // Calculate maturity score
            const maturityScore = calculateMaturityScore(companyProfile);
            
            // Calculate app rankings
            const rankedApps = calculateAppRankings(selectedApps);
            
            // Display results
            displayResults(rankedApps, companyProfile, maturityScore);
            
            // Show results section
            resultsDiv.style.display = 'block';
            
            // Scroll to results
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
            
            // Store assessment data in session storage for later use
            const assessmentData = {
                profile: companyProfile,
                maturityScore: maturityScore,
                apps: selectedApps,
                rankedApps: rankedApps,
                date: new Date().toISOString()
            };
            
            sessionStorage.setItem('currentAssessment', JSON.stringify(assessmentData));
        });
        
        // Calculate maturity score
        function calculateMaturityScore(profile) {
            let score = 0;
            let maxScore = 0;
            
            // Calculate score based on company profile
            for (const [key, value] of Object.entries(profile)) {
                if (key !== 'companyName' && scoringSystem[key]) {
                    score += scoringSystem[key][value] || 0;
                    maxScore += 5; // Maximum score for each category is 5
                }
            }
            
            // Calculate percentage
            return Math.round((score / maxScore) * 100);
        }
        
        // Calculate app rankings
        function calculateAppRankings(apps) {
            // Calculate combined scores with synergy
            apps.forEach(app => {
                app.combinedScore = calculateCombinedScore(app, apps.filter(a => a.name !== app.name));
            });
            
            // Sort apps by combined score
            return [...apps].sort((a, b) => b.combinedScore - a.combinedScore);
        }
        
        // Display results
        function displayResults(rankedApps, profile, maturityScore) {
            // Display maturity score
            displayMaturityScore(maturityScore);
            
            // Display app rankings
            displayAppRankings(rankedApps);
            
            // Display detailed app analysis
            displayAppAnalysis(rankedApps);
            
            // Display synergy analysis
            displaySynergyAnalysis(rankedApps);
            
            // Display recommendations
            displayRecommendations(rankedApps, profile, maturityScore);
            
            // Display implementation plan
            displayImplementationPlan(rankedApps, profile, maturityScore);
        }
        
        // Display maturity score
        function displayMaturityScore(score) {
            const maturityScoreDiv = document.getElementById('maturity-score');
            
            let maturityLevel = "Beginner";
            let maturityColor = "#e74c3c";
            
            if (score >= 80) {
                maturityLevel = "Advanced";
                maturityColor = "#2ecc71";
            } else if (score >= 60) {
                maturityLevel = "Established";
                maturityColor = "#3498db";
            } else if (score >= 40) {
                maturityLevel = "Developing";
                maturityColor = "#f39c12";
            }
            
            maturityScoreDiv.innerHTML = `
                <div class="score-value" style="color: ${maturityColor}">${score}</div>
                <div class="score-label">Tech Maturity Score</div>
                <div class="score-level" style="color: ${maturityColor}">${maturityLevel}</div>
            `;
        }
        
        // Display app rankings
        function displayAppRankings(rankedApps) {
            appRankingsDiv.innerHTML = '';
            
            rankedApps.forEach((app, index) => {
                const appCard = document.createElement('div');
                appCard.className = 'app-card';
                appCard.innerHTML = `
                    <div class="app-card-rank">${index + 1}</div>
                    <div class="app-card-content">
                        <h3>${app.name}</h3>
                        <p>${app.category}</p>
                        <div class="app-card-stats">
                            <div class="stat">
                                <div class="stat-label">Overall Score</div>
                                <div class="stat-value">${app.combinedScore.toFixed(1)}</div>
                            </div>
                            ${app.functionality ? `
                            <div class="stat">
                                <div class="stat-label">Functionality</div>
                                <div class="stat-value">${app.functionality}</div>
                            </div>
                            <div class="stat">
                                <div class="stat-label">UX</div>
                                <div class="stat-value">${app.userExperience}</div>
                            </div>
                            <div class="stat">
                                <div class="stat-label">Integration</div>
                                <div class="stat-value">${app.integration}</div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                appRankingsDiv.appendChild(appCard);
            });
        }
        
        // Display detailed app analysis
        function displayAppAnalysis(rankedApps) {
            const appAnalysisDiv = document.getElementById('app-analysis');
            appAnalysisDiv.innerHTML = '';
            
            rankedApps.forEach(app => {
                // Generate strengths and weaknesses based on app scores
                const strengths = [];
                const weaknesses = [];
                
                if (app.functionality >= 4) strengths.push("Strong feature set that meets business needs");
                if (app.functionality < 3) weaknesses.push("Limited functionality compared to alternatives");
                
                if (app.userExperience >= 4) strengths.push("Excellent user interface and experience");
                if (app.userExperience < 3) weaknesses.push("User interface may be challenging for new users");
                
                if (app.integration >= 4) strengths.push("Robust integration capabilities with other tools");
                if (app.integration < 3) weaknesses.push("Limited integration options with other systems");
                
                if (app.scalability >= 4) strengths.push("Scales well with business growth");
                if (app.scalability < 3) weaknesses.push("May face performance issues as usage increases");
                
                if (app.security >= 4) strengths.push("Strong security features and compliance capabilities");
                if (app.security < 3) weaknesses.push("Security features may need enhancement");
                
                if (app.support >= 4) strengths.push("Excellent customer support and reliability");
                if (app.support < 3) weaknesses.push("Support response times may be inconsistent");
                
                if (app.value >= 4) strengths.push("Excellent value for the investment");
                if (app.value < 3) weaknesses.push("Cost may outweigh benefits for some organizations");
                
                // If we don't have enough strengths or weaknesses, add generic ones
                if (strengths.length < 2) {
                    strengths.push("Provides core functionality needed for business operations");
                    strengths.push("Established product with regular updates");
                }
                
                if (weaknesses.length < 2) {
                    weaknesses.push("May benefit from additional customization for specific workflows");
                    weaknesses.push("Training may be required for optimal use");
                }
                
                // Create app detail card
                const appDetailCard = document.createElement('div');
                appDetailCard.className = 'app-detail-card';
                appDetailCard.innerHTML = `
                    <div class="app-detail-header">
                        <div class="app-detail-name">${app.name}</div>
                        <div class="app-detail-score">Overall Score: ${app.combinedScore.toFixed(1)}/5</div>
                    </div>
                    <div class="app-metrics">
                        ${app.functionality ? `
                        <div class="app-metric">
                            <div class="metric-name">Functionality</div>
                            <div class="metric-value">${app.functionality}/5</div>
                        </div>
                        <div class="app-metric">
                            <div class="metric-name">User Experience</div>
                            <div class="metric-value">${app.userExperience}/5</div>
                        </div>
                        <div class="app-metric">
                            <div class="metric-name">Integration</div>
                            <div class="metric-value">${app.integration}/5</div>
                        </div>
                        <div class="app-metric">
                            <div class="metric-name">Scalability</div>
                            <div class="metric-value">${app.scalability}/5</div>
                        </div>
                        <div class="app-metric">
                            <div class="metric-name">Security</div>
                            <div class="metric-value">${app.security}/5</div>
                        </div>
                        <div class="app-metric">
                            <div class="metric-name">Support</div>
                            <div class="metric-value">${app.support}/5</div>
                        </div>
                        <div class="app-metric">
                            <div class="metric-name">Value</div>
                            <div class="metric-value">${app.value}/5</div>
                        </div>
                        ` : ''}
                    </div>
                    <div class="app-strengths-weaknesses">
                        <div class="app-strengths">
                            <h4>Strengths</h4>
                            <ul>
                                ${strengths.map(strength => `<li>${strength}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="app-weaknesses">
                            <h4>Areas for Improvement</h4>
                            <ul>
                                ${weaknesses.map(weakness => `<li>${weakness}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    <div class="app-recommendations">
                        <h4>Key Recommendations</h4>
                        <ul>
                            <li>Regularly review ${app.name} usage patterns to optimize workflows</li>
                            <li>Schedule quarterly training sessions for team members</li>
                            <li>Establish clear governance policies for ${app.name} usage</li>
                        </ul>
                    </div>
                `;
                
                appAnalysisDiv.appendChild(appDetailCard);
            });
        }
        
        // Display synergy analysis
        function displaySynergyAnalysis(rankedApps) {
            const synergyAnalysisDiv = document.getElementById('synergy-analysis');
            
            // Only show synergy analysis if there are multiple apps
            if (rankedApps.length <= 1) {
                synergyAnalysisDiv.innerHTML = '<p>Synergy analysis requires at least two applications to be selected.</p>';
                return;
            }
            
            // Create synergy matrix
            const synergyMatrix = document.createElement('div');
            synergyMatrix.className = 'synergy-matrix';
            
            // Generate synergy pairs
            const synergyPairs = [];
            
            for (let i = 0; i < rankedApps.length; i++) {
                for (let j = i + 1; j < rankedApps.length; j++) {
                    const app1 = rankedApps[i];
                    const app2 = rankedApps[j];
                    
                    // Calculate synergy score
                    let synergyScore = 0;
                    let synergyDescription = "These applications have limited direct integration capabilities.";
                    
                    if (app1.synergyWith && app1.synergyWith[app2.name]) {
                        synergyScore = app1.synergyWith[app2.name] * 10; // Convert to scale of 10
                        synergyDescription = `These applications have strong integration capabilities, enhancing overall workflow efficiency by approximately ${(app1.synergyWith[app2.name] * 100).toFixed(0)}%.`;
                    } else if (app2.synergyWith && app2.synergyWith[app1.name]) {
                        synergyScore = app2.synergyWith[app1.name] * 10; // Convert to scale of 10
                        synergyDescription = `These applications have strong integration capabilities, enhancing overall workflow efficiency by approximately ${(app2.synergyWith[app1.name] * 100).toFixed(0)}%.`;
                    } else if (app1.category === app2.category) {
                        // Apps in the same category might have some synergy
                        synergyScore = 2;
                        synergyDescription = "These applications serve similar purposes and may have overlapping functionality. Consider consolidating to reduce complexity.";
                    } else {
                        // Generic synergy based on integration scores
                        const avgIntegration = (app1.integration + app2.integration) / 2;
                        synergyScore = avgIntegration / 2;
                        synergyDescription = "These applications may have limited direct integration but can be connected through middleware or API solutions.";
                    }
                    
                    synergyPairs.push({
                        app1: app1.name,
                        app2: app2.name,
                        score: synergyScore,
                        description: synergyDescription
                    });
                }
            }
            
            // Sort synergy pairs by score
            synergyPairs.sort((a, b) => b.score - a.score);
            
            // Display synergy pairs
            synergyPairs.forEach(pair => {
                const synergyPairDiv = document.createElement('div');
                synergyPairDiv.className = 'synergy-pair';
                synergyPairDiv.innerHTML = `
                    <div class="synergy-apps">${pair.app1} + ${pair.app2}</div>
                    <div class="synergy-score">${pair.score.toFixed(1)}/10</div>
                    <div class="synergy-description">${pair.description}</div>
                `;
                
                synergyMatrix.appendChild(synergyPairDiv);
            });
            
            synergyAnalysisDiv.appendChild(synergyMatrix);
        }
        
        // Display recommendations
        function displayRecommendations(rankedApps, profile, maturityScore) {
            recommendationsDiv.innerHTML = '';
            
            // Generate recommendations based on maturity score and apps
            const recommendations = [];
            
            // Basic recommendations based on maturity score
            if (maturityScore < 30) {
                recommendations.push({
                    category: "Foundation Building",
                    tasks: [
                        "Establish basic backup procedures for critical data",
                        "Implement standard security practices (password policies, access controls)",
                        "Document current technology stack and identify critical gaps",
                        "Consider fractional CTO support for strategic guidance",
                        "Create a simple technology roadmap with 6-month horizon"
                    ]
                });
            } else if (maturityScore < 60) {
                recommendations.push({
                    category: "Process Improvement",
                    tasks: [
                        "Implement automated backup solutions for all business data",
                        "Establish basic CI/CD pipeline for development projects",
                        "Standardize version control practices across all projects",
                        "Conduct quarterly technology review meetings",
                        "Begin formal security assessment program"
                    ]
                });
            } else {
                recommendations.push({
                    category: "Advanced Optimization",
                    tasks: [
                        "Implement comprehensive disaster recovery testing",
                        "Establish formal security compliance program (ISO 27001, SOC2)",
                        "Create cross-functional technology governance committee",
                        "Develop AI ethics framework and governance model",
                        "Implement continuous technology innovation program"
                    ]
                });
            }
            
            // App-specific recommendations
            if (rankedApps.length > 0) {
                const topApp = rankedApps[0];
                
                recommendations.push({
                    category: "App Optimization",
                    tasks: [
                        `Maximize ${topApp.name} integration with other tools in your stack`,
                        `Schedule regular training sessions for team members on ${topApp.name}`,
                        `Review ${topApp.name} security settings and permissions`,
                        `Explore premium features of ${topApp.name} that align with business goals`,
                        `Document ${topApp.name} best practices for your organization`
                    ]
                });
                
                // If there are multiple apps, add integration recommendation
                if (rankedApps.length > 1) {
                    recommendations.push({
                        category: "Integration Strategy",
                        tasks: [
                            `Create data flow diagram between ${rankedApps[0].name} and ${rankedApps[1].name}`,
                            "Identify automation opportunities between your top applications",
                            "Establish API connection protocols and documentation",
                            "Implement single sign-on across your application stack",
                            "Create integration testing procedures for critical workflows"
                        ]
                    });
                }
            }
            
            // Infrastructure recommendations based on profile
            if (profile.infrastructure === "On-premise") {
                recommendations.push({
                    category: "Infrastructure Modernization",
                    tasks: [
                        "Assess cloud migration opportunities for non-critical systems",
                        "Implement hybrid backup solution with cloud storage",
                        "Document current infrastructure with disaster recovery considerations",
                        "Evaluate virtualization opportunities for on-premise servers",
                        "Create cloud migration roadmap with cost-benefit analysis"
                    ]
                });
            } else if (profile.infrastructure === "Hybrid") {
                recommendations.push({
                    category: "Cloud Optimization",
                    tasks: [
                        "Standardize deployment processes across cloud and on-premise",
                        "Implement unified monitoring solution for all infrastructure",
                        "Optimize cloud resource allocation and cost management",
                        "Create cloud-first evaluation criteria for new systems",
                        "Develop comprehensive disaster recovery plan spanning all environments"
                    ]
                });
            }
            
            // AI recommendations based on profile
            if (profile.aiUsage === "Not at all" || profile.aiUsage === "Experimenting in some departments") {
                recommendations.push({
                    category: "AI Adoption",
                    tasks: [
                        "Identify 3-5 processes that could benefit from AI automation",
                        "Conduct AI readiness assessment for data quality and availability",
                        "Develop basic AI ethics guidelines for your organization",
                        "Pilot a small-scale AI project with measurable outcomes",
                        "Create AI skills development plan for key team members"
                    ]
                });
            } else {
                recommendations.push({
                    category: "AI Advancement",
                    tasks: [
                        "Establish formal AI governance framework with oversight committee",
                        "Implement AI model monitoring and performance tracking",
                        "Develop comprehensive AI ethics training program",
                        "Create AI innovation pipeline with regular evaluation process",
                        "Establish AI center of excellence to share best practices"
                    ]
                });
            }
            
            // Display recommendations
            recommendations.forEach(rec => {
                const recStep = document.createElement('div');
                recStep.className = 'recommendation-step';
                recStep.innerHTML = `
                    <h3>${rec.category}</h3>
                    <ul>
                        ${rec.tasks.map(task => `<li>${task}</li>`).join('')}
                    </ul>
                `;
                recommendationsDiv.appendChild(recStep);
            });
        }
        
        // Display implementation plan
        function displayImplementationPlan(rankedApps, profile, maturityScore) {
            const implementationPlanDiv = document.getElementById('implementation-plan');
            implementationPlanDiv.innerHTML = '';
            
            // Generate implementation phases
            const phases = [
                {
                    title: "Phase 1: Immediate Actions (0-30 days)",
                    timeline: "Next 30 days",
                    tasks: [
                        "Conduct comprehensive technology audit",
                        "Document current application usage and pain points",
                        "Establish baseline metrics for key systems",
                        "Identify quick wins for immediate implementation",
                        "Form technology steering committee"
                    ],
                    resources: "Requires involvement from IT team and department heads"
                },
                {
                    title: "Phase 2: Foundation Building (1-3 months)",
                    timeline: "Months 1-3",
                    tasks: [
                        "Implement priority security improvements",
                        "Standardize backup and recovery procedures",
                        "Begin user training on core applications",
                        "Develop integration strategy for key systems",
                        "Establish technology governance policies"
                    ],
                    resources: "Budget allocation required for security tools and training resources"
                },
                {
                    title: "Phase 3: Optimization & Integration (3-6 months)",
                    timeline: "Months 3-6",
                    tasks: [
                        "Implement automation for repetitive processes",
                        "Enhance integration between core applications",
                        "Optimize infrastructure for performance and cost",
                        "Develop metrics dashboard for technology performance",
                        "Begin pilot projects for new technologies"
                    ],
                    resources: "May require external consultants for specialized integration work"
                },
                {
                    title: "Phase 4: Innovation & Scaling (6-12 months)",
                    timeline: "Months 6-12",
                    tasks: [
                        "Evaluate emerging technologies for business impact",
                        "Scale successful pilot projects across organization",
                        "Implement advanced security measures",
                        "Develop long-term technology roadmap",
                        "Establish continuous improvement framework"
                    ],
                    resources: "Requires executive sponsorship and dedicated innovation budget"
                }
            ];
            
            // Display implementation phases
            phases.forEach(phase => {
                const phaseDiv = document.createElement('div');
                phaseDiv.className = 'implementation-phase';
                phaseDiv.innerHTML = `
                    <div class="phase-header">
                        <div class="phase-title">${phase.title}</div>
                        <div class="phase-timeline">${phase.timeline}</div>
                    </div>
                    <div class="phase-tasks">
                        <ul>
                            ${phase.tasks.map(task => `<li>${task}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="phase-resources">
                        <strong>Resources:</strong> ${phase.resources}
                    </div>
                `;
                
                implementationPlanDiv.appendChild(phaseDiv);
            });
        }

        // Authentication functions
        async function register(username, email, password) {
            try {
                const response = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, email, password })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'Registration failed');
                }
                
                return data;
            } catch (error) {
                console.error('Registration error:', error);
                throw error;
            }
        }
        
        async function login(username, password) {
            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'Login failed');
                }
                
                // Store token and user info
                localStorage.setItem('token', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));
                
                return data;
            } catch (error) {
                console.error('Login error:', error);
                throw error;
            }
        }
        
        async function checkAuth() {
            try {
                const token = localStorage.getItem('token');
                
                if (!token) {
                    return false;
                }
                
                const response = await fetch(`${API_URL}/auth/me`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'Authentication failed');
                }
                
                // Update user info
                localStorage.setItem('user', JSON.stringify(data));
                
                return data;
            } catch (error) {
                console.error('Auth check error:', error);
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                return false;
            }
        }
        
        // Profile functions
        async function getProfile() {
            try {
                const token = localStorage.getItem('token');
                
                if (!token) {
                    throw new Error('No authentication token found');
                }
                
                const response = await fetch(`${API_URL}/profile`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                // Check if response is JSON
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    const data = await response.json();
                    
                    if (!response.ok) {
                        throw new Error(data.message || 'Failed to get profile');
                    }
                    
                    return data;
                } else {
                    // Handle non-JSON response
                    const text = await response.text();
                    console.log('Non-JSON response:', text);
                    
                    if (!response.ok) {
                        throw new Error('Failed to get profile: Server returned non-JSON response');
                    }
                    
                    // Return an empty profile
                    return {
                        companyName: '',
                        teamSize: '1-10',
                        infrastructure: 'On-premise',
                        disasterRecovery: 'No backups',
                        security: 'None',
                        gdpr: 'None',
                        deployment: 'Manual',
                        versionControl: 'No',
                        cto: 'No dedicated tech leader',
                        roadmap: 'Never',
                        aiUsage: 'Not at all',
                        aiStrategy: 'No strategy/policy',
                        aiEthics: 'Not considered'
                    };
                }
            } catch (error) {
                console.error('Get profile error:', error);
                
                // Return an empty profile on error
                return {
                    companyName: '',
                    teamSize: '1-10',
                    infrastructure: 'On-premise',
                    disasterRecovery: 'No backups',
                    security: 'None',
                    gdpr: 'None',
                    deployment: 'Manual',
                    versionControl: 'No',
                    cto: 'No dedicated tech leader',
                    roadmap: 'Never',
                    aiUsage: 'Not at all',
                    aiStrategy: 'No strategy/policy',
                    aiEthics: 'Not considered'
                };
            }
        }
        
        async function updateProfile(profileData) {
            try {
                const token = localStorage.getItem('token');
                
                if (!token) {
                    throw new Error('No authentication token found');
                }
                
                const response = await fetch(`${API_URL}/profile`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(profileData)
                });
                
                // Check if response is JSON
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    const data = await response.json();
                    
                    if (!response.ok) {
                        throw new Error(data.message || 'Failed to update profile');
                    }
                    
                    return data;
                } else {
                    // Handle non-JSON response
                    const text = await response.text();
                    console.log('Non-JSON response:', text);
                    
                    if (!response.ok) {
                        throw new Error('Failed to update profile: Server returned non-JSON response');
                    }
                    
                    // Return a default success response
                    return { success: true, message: 'Profile updated successfully' };
                }
            } catch (error) {
                console.error('Update profile error:', error);
                throw error;
            }
        }
        
        async function createProfile(profileData) {
            try {
                const token = localStorage.getItem('token');
                
                if (!token) {
                    throw new Error('No authentication token found');
                }
                
                const response = await fetch(`${API_URL}/profile`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(profileData)
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'Failed to create profile');
                }
                
                return data;
            } catch (error) {
                console.error('Create profile error:', error);
                throw error;
            }
        }
        
        // Admin functions
        async function getAllProfiles() {
            try {
                const token = localStorage.getItem('token');
                
                if (!token) {
                    throw new Error('No authentication token found');
                }
                
                const response = await fetch(`${API_URL}/profile/all`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'Failed to get profiles');
                }
                
                return data;
            } catch (error) {
                console.error('Get all profiles error:', error);
                throw error;
            }
        }
        
        // Event listeners
        showRegisterLink.addEventListener('click', function(e) {
            e.preventDefault();
            loginForm.style.display = 'none';
            registerForm.style.display = 'block';
        });
        
        showLoginLink.addEventListener('click', function(e) {
            e.preventDefault();
            registerForm.style.display = 'none';
            loginForm.style.display = 'block';
        });
        
        loginBtn.addEventListener('click', async function() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                loginError.textContent = 'Please enter both username and password';
                return;
            }
            
            try {
                loginError.textContent = 'Logging in...';
                const data = await login(username, password);
                
                // Check if user is admin
                const user = data.user;
                if (user.role === 'admin') {
                    adminTabContainer.style.display = 'block';
                    loadAllProfiles();
                }
                
                // Show main content
                loginContainer.style.display = 'none';
                mainContent.style.display = 'block';
                
                // Load profile
                loadProfile();
            } catch (error) {
                loginError.textContent = error.message || 'Login failed. Please check your credentials.';
            }
        });
        
        registerBtn.addEventListener('click', async function() {
            const username = document.getElementById('reg-username').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            const confirmPassword = document.getElementById('reg-confirm-password').value;
            
            if (!username || !email || !password || !confirmPassword) {
                registerError.textContent = 'Please fill in all fields';
                return;
            }
            
            if (password !== confirmPassword) {
                registerError.textContent = 'Passwords do not match';
                return;
            }
            
            try {
                registerError.textContent = 'Registering...';
                await register(username, email, password);
                
                // Show login form
                registerForm.style.display = 'none';
                loginForm.style.display = 'block';
                loginError.textContent = 'Registration successful. Please log in.';
            } catch (error) {
                registerError.textContent = error.message || 'Registration failed. Please try again.';
            }
        });
        
        logoutBtn.addEventListener('click', function() {
            // Clear local storage
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            
            // Show login container
            mainContent.style.display = 'none';
            loginContainer.style.display = 'flex';
            
            // Reset login forms
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            loginError.textContent = '';
            
            // Reset assessment form fields
            document.getElementById('company-name').value = '';
            document.getElementById('team-size').value = '1-10';
            document.getElementById('infrastructure').value = 'On-premise';
            document.getElementById('disaster-recovery').value = 'No backups';
            document.getElementById('security').value = 'None';
            document.getElementById('gdpr').value = 'None';
            document.getElementById('deployment').value = 'Manual';
            document.getElementById('version-control').value = 'No';
            document.getElementById('cto').value = 'No dedicated tech leader';
            document.getElementById('roadmap').value = 'Never';
            document.getElementById('ai-usage').value = 'Not at all';
            document.getElementById('ai-strategy').value = 'No strategy/policy';
            document.getElementById('ai-ethics').value = 'Not considered';
            
            // Clear selected apps
            selectedApps = [];
            updateSelectedAppsUI();
            
            // Reset results
            resultsDiv.style.display = 'none';
            
            // Hide admin tab
            adminTabContainer.style.display = 'none';
        });
        
        // Tab navigation
        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Remove active class from all tabs and contents
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding content
                this.classList.add('active');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });
        
        // Profile tab functionality
        editProfileBtn.addEventListener('click', function() {
            profileInfo.style.display = 'none';
            editProfileForm.style.display = 'block';
        });
        
        saveProfileBtn.addEventListener('click', async function() {
            try {
                // Get form values
                const profileData = {
                    companyName: document.getElementById('edit-company-name').value,
                    teamSize: document.getElementById('edit-team-size').value,
                    infrastructure: document.getElementById('edit-infrastructure').value,
                    disasterRecovery: document.getElementById('edit-disaster-recovery').value,
                    security: document.getElementById('edit-security').value,
                    gdpr: document.getElementById('edit-gdpr').value,
                    deployment: document.getElementById('edit-deployment').value,
                    versionControl: document.getElementById('edit-version-control').value,
                    cto: document.getElementById('edit-cto').value,
                    roadmap: document.getElementById('edit-roadmap').value,
                    aiUsage: document.getElementById('edit-ai-usage').value,
                    aiStrategy: document.getElementById('edit-ai-strategy').value,
                    aiEthics: document.getElementById('edit-ai-ethics').value,
                    selectedApps: selectedApps || []
                };
                
                console.log('Saving profile data:', profileData);
                
                // Get token
                const token = localStorage.getItem('token');
                if (!token) {
                    throw new Error('No authentication token found');
                }
                
                // Send request directly to API
                const response = await fetch(`${API_URL}/profile`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(profileData)
                });
                
                // Process response
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.message || `Failed to save profile: ${response.status}`);
                }
                
                const data = await response.json().catch(() => ({ success: true }));
                console.log('Profile saved successfully:', data);
                
                // Show success message
                alert('Profile saved successfully!');
                
                // Update profile display directly
                profileInfo.innerHTML = `
                    <div class="profile-info-item">
                        <div class="profile-info-label">Company Name</div>
                        <div class="profile-info-value">${profileData.companyName || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Team Size</div>
                        <div class="profile-info-value">${profileData.teamSize || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Infrastructure</div>
                        <div class="profile-info-value">${profileData.infrastructure || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Disaster Recovery</div>
                        <div class="profile-info-value">${profileData.disasterRecovery || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Security</div>
                        <div class="profile-info-value">${profileData.security || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">GDPR Compliance</div>
                        <div class="profile-info-value">${profileData.gdpr || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Deployment Process</div>
                        <div class="profile-info-value">${profileData.deployment || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Version Control</div>
                        <div class="profile-info-value">${profileData.versionControl || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Tech Leadership</div>
                        <div class="profile-info-value">${profileData.cto || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Tech Roadmap</div>
                        <div class="profile-info-value">${profileData.roadmap || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">AI Usage</div>
                        <div class="profile-info-value">${profileData.aiUsage || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">AI Strategy</div>
                        <div class="profile-info-value">${profileData.aiStrategy || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">AI Ethics</div>
                        <div class="profile-info-value">${profileData.aiEthics || 'Not set'}</div>
                    </div>
                `;
                
                // Show profile info
                editProfileForm.style.display = 'none';
                profileInfo.style.display = 'block';
                
                // Force reload profile in background for next time
                setTimeout(() => {
                    try {
                        fetch(`${API_URL}/profile?nocache=${Date.now()}`, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                    } catch (e) {
                        console.log('Background refresh error:', e);
                    }
                }, 500);
                
            } catch (error) {
                console.error('Save profile error:', error);
                alert('Failed to save profile: ' + error.message);
            }
        });
        
        // Load profile
        async function loadProfile() {
            try {
                const profile = await getProfile();
                
                // Display profile info
                profileInfo.innerHTML = `
                    <div class="profile-info-item">
                        <div class="profile-info-label">Company Name</div>
                        <div class="profile-info-value">${profile.companyName || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Team Size</div>
                        <div class="profile-info-value">${profile.teamSize || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Infrastructure</div>
                        <div class="profile-info-value">${profile.infrastructure || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Disaster Recovery</div>
                        <div class="profile-info-value">${profile.disasterRecovery || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Security</div>
                        <div class="profile-info-value">${profile.security || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">GDPR Compliance</div>
                        <div class="profile-info-value">${profile.gdpr || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Deployment Process</div>
                        <div class="profile-info-value">${profile.deployment || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Version Control</div>
                        <div class="profile-info-value">${profile.versionControl || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Technical Leadership</div>
                        <div class="profile-info-value">${profile.cto || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Roadmap Review</div>
                        <div class="profile-info-value">${profile.roadmap || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">AI Usage</div>
                        <div class="profile-info-value">${profile.aiUsage || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">AI Strategy</div>
                        <div class="profile-info-value">${profile.aiStrategy || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">AI Ethics</div>
                        <div class="profile-info-value">${profile.aiEthics || 'Not set'}</div>
                    </div>
                `;
                
                // Fill edit form
                document.getElementById('edit-company-name').value = profile.companyName || '';
                document.getElementById('edit-team-size').value = profile.teamSize || '1-10';
                document.getElementById('edit-infrastructure').value = profile.infrastructure || 'On-premise';
                document.getElementById('edit-disaster-recovery').value = profile.disasterRecovery || 'No backups';
                document.getElementById('edit-security').value = profile.security || 'None';
                document.getElementById('edit-gdpr').value = profile.gdpr || 'None';
                document.getElementById('edit-deployment').value = profile.deployment || 'Manual';
                document.getElementById('edit-version-control').value = profile.versionControl || 'No';
                document.getElementById('edit-cto').value = profile.cto || 'No dedicated tech leader';
                document.getElementById('edit-roadmap').value = profile.roadmap || 'Never';
                document.getElementById('edit-ai-usage').value = profile.aiUsage || 'Not at all';
                document.getElementById('edit-ai-strategy').value = profile.aiStrategy || 'No strategy/policy';
                document.getElementById('edit-ai-ethics').value = profile.aiEthics || 'Not considered';
                // Load selected apps if available
                if (profile.selectedApps && Array.isArray(profile.selectedApps) && profile.selectedApps.length > 0) {
                    console.log("Loading selected apps from profile:", profile.selectedApps);
                    selectedApps = profile.selectedApps;
                    updateSelectedAppsUI();
                }
                
                // Also update the assessment form
                document.getElementById('company-name').value = profile.companyName || '';
                document.getElementById('team-size').value = profile.teamSize || '1-10';
                document.getElementById('infrastructure').value = profile.infrastructure || 'On-premise';
                document.getElementById('disaster-recovery').value = profile.disasterRecovery || 'No backups';
                document.getElementById('security').value = profile.security || 'None';
                document.getElementById('gdpr').value = profile.gdpr || 'None';
                document.getElementById('deployment').value = profile.deployment || 'Manual';
                document.getElementById('version-control').value = profile.versionControl || 'No';
                document.getElementById('cto').value = profile.cto || 'No dedicated tech leader';
                document.getElementById('roadmap').value = profile.roadmap || 'Never';
                document.getElementById('ai-usage').value = profile.aiUsage || 'Not at all';
                document.getElementById('ai-strategy').value = profile.aiStrategy || 'No strategy/policy';
                document.getElementById('ai-ethics').value = profile.aiEthics || 'Not considered';
            } catch (error) {
                // If profile not found, show empty form
                if (error.message.includes('not found')) {
                    profileInfo.innerHTML = `<p>No profile found. Please create one.</p>`;
                    editProfileBtn.click(); // Show edit form
                } else {
                    profileInfo.innerHTML = `<p>Failed to load profile: ${error.message}</p>`;
                }
            }
        }
        
        // Load all profiles (admin only)
        async function loadAllProfiles() {
            try {
                const profiles = await getAllProfiles();
                
                userList.innerHTML = '';
                
                if (profiles.length === 0) {
                    userList.innerHTML = '<p>No profiles found.</p>';
                    return;
                }
                
                profiles.forEach(profile => {
                    const userItem = document.createElement('div');
                    userItem.className = 'user-item';
                    userItem.innerHTML = `
                        <h3>${profile.user?.username || 'Unknown User'}</h3>
                        <p>Company: ${profile.companyName || 'Not set'}</p>
                        <p>Team Size: ${profile.teamSize || 'Not set'}</p>
                        <p>Infrastructure: ${profile.infrastructure || 'Not set'}</p>
                    `;
                    userList.appendChild(userItem);
                });
            } catch (error) {
                userList.innerHTML = `<p>Failed to load profiles: ${error.message}</p>`;
            }
        }
        
        // Check if user is already logged in
        async function init() {
            const user = await checkAuth();
            
            if (user) {
                // Show main content
                loginContainer.style.display = 'none';
                mainContent.style.display = 'block';
                
                // Check if user is admin
                if (user.role === 'admin') {
                    adminTabContainer.style.display = 'block';
                    loadAllProfiles();
                }
                
                // Load profile
                loadProfile();
            }
        }
        
        // Save assessment button click handler
        document.getElementById('save-assessment-btn').addEventListener('click', async function() {
            try {
                const currentAssessment = JSON.parse(sessionStorage.getItem('currentAssessment'));
                
                if (!currentAssessment) {
                    alert('No assessment data found. Please run the assessment first.');
                    return;
                }
                
                const token = localStorage.getItem('token');
                
                if (!token) {
                    alert('You must be logged in to save assessment results.');
                    return;
                }
                
                // Save assessment data to profile
                const profileData = {
                    ...currentAssessment.profile,
                    assessmentResults: {
                        maturityScore: currentAssessment.maturityScore,
                        apps: currentAssessment.apps.map(app => ({
                            name: app.name,
                            category: app.category,
                            score: app.combinedScore || app.overallScore
                        })),
                        date: currentAssessment.date
                    },
                    selectedApps: currentAssessment.apps.map(app => ({ name: app.name, category: app.category }))
                };
                
                try {
                    console.log('Saving assessment data to profile:', profileData);
                    
                    // Get token
                    const token = localStorage.getItem('token');
                    if (!token) {
                        throw new Error('No authentication token found');
                    }
                    
                    // Send request directly to API
                    const response = await fetch(`${API_URL}/profile`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify(profileData)
                    });
                    
                    // Process response
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(errorData.message || `Failed to save assessment: ${response.status}`);
                    }
                    
                    const data = await response.json().catch(() => ({ success: true }));
                    console.log('Assessment data saved successfully:', data);
                    
                    alert('Assessment results saved successfully!');
                    
                    // Force reload profile in background for next time
                    setTimeout(() => {
                        try {
                            fetch(`${API_URL}/profile?nocache=${Date.now()}`, {
                                headers: {
                                    'Authorization': `Bearer ${token}`
                                }
                            });
                        } catch (e) {
                            console.log('Background refresh error:', e);
                        }
                    }, 500);
                    
                } catch (error) {
                    console.error('Error saving assessment:', error);
                    alert('Failed to save assessment: ' + error.message);
                }
            } catch (error) {
                alert('Failed to save assessment: ' + error.message);
                console.error('Save assessment error:', error);
            }
        });
        
        // Download PDF button click handler
        document.getElementById('download-pdf-btn').addEventListener('click', function() {
            const currentAssessment = JSON.parse(sessionStorage.getItem('currentAssessment'));
            
            if (!currentAssessment) {
                alert('No assessment data found. Please run the assessment first.');
                return;
            }
            
            // Alert user that this feature is coming soon
            alert('PDF download functionality will be available in the next update. Your assessment results have been saved to your profile.');
        });
        
        // Enhanced profile loading to show assessment history
        async function loadProfile() {
            try {
                const profile = await getProfile();
                
                // Display profile info
                let profileHTML = `
                    <div class="profile-info-item">
                        <div class="profile-info-label">Company Name</div>
                        <div class="profile-info-value">${profile.companyName || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Team Size</div>
                        <div class="profile-info-value">${profile.teamSize || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Infrastructure</div>
                        <div class="profile-info-value">${profile.infrastructure || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Disaster Recovery</div>
                        <div class="profile-info-value">${profile.disasterRecovery || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Security</div>
                        <div class="profile-info-value">${profile.security || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">GDPR Compliance</div>
                        <div class="profile-info-value">${profile.gdpr || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Deployment Process</div>
                        <div class="profile-info-value">${profile.deployment || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Version Control</div>
                        <div class="profile-info-value">${profile.versionControl || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Technical Leadership</div>
                        <div class="profile-info-value">${profile.cto || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Roadmap Review</div>
                        <div class="profile-info-value">${profile.roadmap || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">AI Usage</div>
                        <div class="profile-info-value">${profile.aiUsage || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">AI Strategy</div>
                        <div class="profile-info-value">${profile.aiStrategy || 'Not set'}</div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">AI Ethics</div>
                        <div class="profile-info-value">${profile.aiEthics || 'Not set'}</div>
                    </div>
                `;
                
                // Add assessment history if available
                if (profile.assessmentResults) {
                    const date = new Date(profile.assessmentResults.date);
                    const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
                    
                    profileHTML += `
                        <div class="profile-info-item assessment-history">
                            <div class="profile-info-label">Latest Assessment</div>
                            <div class="profile-info-value">
                                <div class="assessment-date">Date: ${formattedDate}</div>
                                <div class="assessment-score">Maturity Score: ${profile.assessmentResults.maturityScore}</div>
                                <div class="assessment-apps">
                                    <strong>Assessed Apps:</strong>
                                    <ul>
                                        ${profile.assessmentResults.apps.map(app => `
                                            <li>${app.name} (${app.category}) - Score: ${app.score.toFixed(1)}</li>
                                        `).join('')}
                                    </ul>
                                </div>
                                <button id="view-last-assessment-btn" class="view-btn">View Full Assessment</button>
                            </div>
                        </div>
                    `;
                }
                
                profileInfo.innerHTML = profileHTML;
                
                // Add event listener for view assessment button if it exists
                const viewAssessmentBtn = document.getElementById('view-last-assessment-btn');
                if (viewAssessmentBtn) {
                    viewAssessmentBtn.addEventListener('click', function() {
                        // Load the saved assessment data
                        const assessmentData = {
                            profile: {
                                companyName: profile.companyName,
                                teamSize: profile.teamSize,
                                infrastructure: profile.infrastructure,
                                disasterRecovery: profile.disasterRecovery,
                                security: profile.security,
                                gdpr: profile.gdpr,
                                deployment: profile.deployment,
                                versionControl: profile.versionControl,
                                cto: profile.cto,
                                roadmap: profile.roadmap,
                                aiUsage: profile.aiUsage,
                                aiStrategy: profile.aiStrategy,
                                aiEthics: profile.aiEthics
                            },
                            maturityScore: profile.assessmentResults.maturityScore,
                            apps: profile.assessmentResults.apps,
                            rankedApps: profile.assessmentResults.apps.sort((a, b) => b.score - a.score),
                            date: profile.assessmentResults.date
                        };
                        
                        // Store in session storage
                        sessionStorage.setItem('currentAssessment', JSON.stringify(assessmentData));
                        
                        // Switch to assessment tab
                        document.querySelector('.tab[data-tab="assessment"]').click();
                        
                        // Show results section
                        resultsDiv.style.display = 'block';
                        
                        // Display results
                        displayResults(assessmentData.rankedApps, assessmentData.profile, assessmentData.maturityScore);
                        
                        // Scroll to results
                        resultsDiv.scrollIntoView({ behavior: 'smooth' });
                    });
                }
                
                // Fill edit form
                document.getElementById('edit-company-name').value = profile.companyName || '';
                document.getElementById('edit-team-size').value = profile.teamSize || '1-10';
                document.getElementById('edit-infrastructure').value = profile.infrastructure || 'On-premise';
                document.getElementById('edit-disaster-recovery').value = profile.disasterRecovery || 'No backups';
                document.getElementById('edit-security').value = profile.security || 'None';
                document.getElementById('edit-gdpr').value = profile.gdpr || 'None';
                document.getElementById('edit-deployment').value = profile.deployment || 'Manual';
                // Load selected apps if available
                if (profile.selectedApps && Array.isArray(profile.selectedApps) && profile.selectedApps.length > 0) {
                    console.log("Loading selected apps from profile:", profile.selectedApps);
                    selectedApps = profile.selectedApps;
                    updateSelectedAppsUI();
                }
                document.getElementById('edit-version-control').value = profile.versionControl || 'No';
                document.getElementById('edit-cto').value = profile.cto || 'No dedicated tech leader';
                document.getElementById('edit-roadmap').value = profile.roadmap || 'Never';
                document.getElementById('edit-ai-usage').value = profile.aiUsage || 'Not at all';
                document.getElementById('edit-ai-strategy').value = profile.aiStrategy || 'No strategy/policy';
                document.getElementById('edit-ai-ethics').value = profile.aiEthics || 'Not considered';
                
                // Also update the assessment form
                document.getElementById('company-name').value = profile.companyName || '';
                document.getElementById('team-size').value = profile.teamSize || '1-10';
                document.getElementById('infrastructure').value = profile.infrastructure || 'On-premise';
                document.getElementById('disaster-recovery').value = profile.disasterRecovery || 'No backups';
                document.getElementById('security').value = profile.security || 'None';
                document.getElementById('gdpr').value = profile.gdpr || 'None';
                document.getElementById('deployment').value = profile.deployment || 'Manual';
                document.getElementById('version-control').value = profile.versionControl || 'No';
                document.getElementById('cto').value = profile.cto || 'No dedicated tech leader';
                document.getElementById('roadmap').value = profile.roadmap || 'Never';
                document.getElementById('ai-usage').value = profile.aiUsage || 'Not at all';
                document.getElementById('ai-strategy').value = profile.aiStrategy || 'No strategy/policy';
                document.getElementById('ai-ethics').value = profile.aiEthics || 'Not considered';
            } catch (error) {
                profileInfo.innerHTML = `<p>Failed to load profile: ${error.message}</p>`;
            }
        }

        // Initialize
        init();
    </script>
</body>
</html>
